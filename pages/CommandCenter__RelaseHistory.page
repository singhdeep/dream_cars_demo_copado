<apex:page controller="CommandCenter.ReleaseRelatedHistory" standardStylesheets="false" showHeader="false" applyBodyTag="false" applyHtmlTag="false" docType="html-5.0">
     <apex:stylesheet value="{!URLFOR($Resource.CommandCenter__SDLCV_2_1_3, '/assets/styles/salesforce-lightning-design-system.css')}"/>
     <script src="https://static.fusioncharts.com/code/latest/fusioncharts.js"/>
    <script src="https://static.fusioncharts.com/code/latest/fusioncharts.charts.js"/>
     
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <head>
    <style>
        .slds-page-header__detail-block{
            max-width: 50% !important;
        }
        
        .slds-tabs--path__item + .slds-is-complete + .slds-is-hidden:before {
          background-color: white;
        }
                
        /* Complete to new step */
        .slds-tabs--path .slds-is-complete + .slds-is-current:before{
            background-color: #4bca81;
        }
        .slds-tabs--path .slds-is-complete + .slds-is-lost:before{
            background-color: #4bca81;
        }
        .slds-tabs--path .slds-is-complete + .slds-is-aborted:before{
            background-color: #4bca81;
        }
        .slds-tabs--path .slds-is-complete + .slds-is-complete:before{
            background-color: #4bca81;
        }
        .slds-tabs--path .slds-is-complete + .slds-is-incomplete:before{
            background-color: #4bca81;
        }
        
        /* Hidden to new Step */
        .slds-tabs--path .slds-is-hidden + .slds-is-current:before{
            background-color: white;
        }
        .slds-tabs--path .slds-is-hidden + .slds-is-lost:before{
            background-color: white;
        }
        .slds-tabs--path .slds-is-hidden + .slds-is-aborted:before{
            background-color: white;
        }
        .slds-tabs--path .slds-is-hidden + .slds-is-complete:before{ 
            background-color: white;
        }
        .slds-tabs--path .slds-is-hidden + .slds-is-hidden:before{
            background-color: white;
        }
        
        /* lost to new Step */
        .slds-tabs--path .slds-is-lost + .slds-is-incomplete:before{
            background-color: #c23934;
        }
        /* aborted to new Step */
        .slds-tabs--path .slds-is-aborted + .slds-is-incomplete:before{
            background-color: #00ccff;
        }
        .slds-tabs--path .slds-is-aborted{
            background-color: #00ccff;
        }
        
        .hide {
          display: none;
        }
        
        .sectionHeader{
            background: #dcf9a2;
            color: #169c1b;
            //padding: 5px;
        }
        
        .sectionHeaderIcon{
            width:20px;
            height:20px;
        }
        
        .pageHeader{
            text-align: center;
            font-weight: bold;
            font-size: 1.75rem;
            color: white;
        }
        .btn{
            
        }
        
        .treeIcon{
            width:20px;
            height:20px;
            margin-top: 5px;
            margin-right: 5px;
        }
        
        .bgcolor{
            background: #BDDEE9;
            //padding-top: 5px;
        }
        
        .buildInfo{
            width: 11%;
            //padding-top: 5px;
            font-size: 15px;
            font-weight: bold;
            border: 1px solid;
            background-color: #e0e5ee;
            border-radius: 1rem;
            height:120px;
        }
        
        .buildInfoIcons{
            width:12px;
            height:10px;
            padding-right: 3px;
        }
        
        .textTruncate {
            -o-text-overflow: ellipsis;   /* Opera */
            text-overflow:    ellipsis;   /* IE, Safari (WebKit) */
            overflow:hidden;              /* dont show excess chars */
            white-space:nowrap;           /* force single line */
            /*width: 300px;*/                 /* fixed width */
        }
        
        .cards{
        //padding: 5px;
            box-sizing: border-box;
        }
        
         #myelem {
            position : absolute;
            }
        
         .exceptionTxt{
        font-style:italic;
        font-size:16px;
        font-weight:bold;
        color:red;
        }
    </style>
     <script>
      
        function readLogs(stageName){
            console.log('*** stageName *** '+stageName);
            readLogs(stageName);
        }
        
    </script>
    
    </head>
    <title>
        Release Management
    </title>
    <body>
    <apex:form id="frm">
        <apex:actionFunction name="doNothing" reRender="errorPanel, deployPanel, pipelinePanel, logPanel, dashboardPanel"/>
        <!--<apex:actionFunction action="{!deleteOldBuilds}" name="deleteBuilds" reRender="frm"/> -->
        <apex:actionFunction action="{!readStageLog}" name="readLogs" reRender="logPanel, stepLogPanel, errorPanel">
            <apex:param name="jobName" value=""/>
        </apex:actionFunction>
        <!-- PAGE HEADER -->
        <c:NavHeaderComp ></c:NavHeaderComp>
        <div class="slds-page-header" role="banner" style="background: inherit;padding-top: 0px;">
                 
            <!-- Panel -->
            <apex:outputPanel id="deployPanel">
            <div class="slds-panel slds-grid slds-grid--vertical slds-nowrap">
                <div class="slds-form--stacked slds-grow slds-scrollable--y">
                    <div class="slds-panel__section slds-has-divider--bottom">
                        <div class="slds-panel__section">
                            <div class="slds-form-element slds-hint-parent">
                                <div class="slds-form-element__control">
                                    <ul class="slds-grid slds-page-header__detail-row">
                                        <!-- PAGE HEADER / ROW 2 / COLUMN 1 -->
                                        <!--<li class="slds-page-header__detail-block">
                                            <p class="slds-text-heading--label-normal slds-truncate slds-m-bottom--xx-small" title="{!$Label.Select_Release}">Select Release </p>
                                            
                                            <apex:selectList value="{!selectedRelease}" size="1" styleClass="slds-picklist" style="padding: 5px;border-radius: 3px;border-color: #ccc;">
                                                <apex:selectOptions value="{!releaseList}"></apex:selectOptions>
                                                <apex:actionSupport action="{!selectRelease}" event="onchange" status="releaseSelect" reRender="frm, releaseSelect, deployPanel"/>

                                            </apex:selectList> 
                                            <apex:actionStatus startText="" stopText="" id="releaseSelect" > 
                                               <apex:facet name="start" > 
                                                   <span style="padding-left:20%;">
                                                       <img src="{!URLFOR($Resource.RM_Resource, '/rm_images/process.gif')}" style="width:30px; height:30px;"/> &nbsp;
                                                   </span>
                                               </apex:facet> 
                                               <apex:facet name="stop">
                                               </apex:facet> 
                                            </apex:actionStatus>
                                        </li> -->
                                        <!-- PAGE HEADER / ROW 2 / COLUMN 3 -->                                     
                                        <li class="slds-page-header__detail-block">
                                       <!-- <c:InfoToolTipComponent toolTipText="Select a job!" toolTipTextClassName="jenkin_Config" icon_Margin_Top="15" icon_Margin_Left="10" position_Left="-13" position_Bottom="-30"  toolTipWidth="100"/> -->
                                            <p class="slds-text-heading--label-normal slds-truncate slds-m-bottom--xx-small" title= "{!$Label.Select_Job}">Select Job </p>
                                            <apex:selectList value="{!selectedOrg}" size="1" styleClass="slds-picklist" style="padding: 5px;border-radius: 3px;border-color: #ccc;">
                                                <apex:selectOptions value="{!orgList}"></apex:selectOptions>
                                                <apex:actionSupport action="{!selectOrg}" event="onchange" status="orgSelect" reRender="frm, Delete, deploy, errorPanel, deployPanel, delete1"/>
                                            </apex:selectList>
                                           <apex:actionStatus startText="" stopText="" id="orgSelect" > 
                                               <apex:facet name="start" > 
                                                   <span style="padding-left:20%;">
                                                       <img src="{!URLFOR($Resource.RM_Resource, '/rm_images/process.gif')}" style="width:30px; height:30px;"/> &nbsp;
                                                   </span>
                                               </apex:facet> 
                                               <apex:facet name="stop">
                                               </apex:facet> 
                                            </apex:actionStatus>
                                        </li>
                                        <!-- PAGE HEADER / ROW 2 / COLUMN 3 -->
                                        <!-- Commented the button, as the same functionality to view pipeline has moved on selecting org -->
                                        <!-- <li class="slds-page-header__detail-block">
                                            <p class="slds-text-heading--label-normal slds-truncate slds-m-bottom--xx-small" title="Field 3"></p>
                                            
                                            <apex:actionStatus startText="" stopText="" id="deploy" > 
                                               <apex:facet name="start" > 
                                                   <span style="padding-left:20%;">
                                                       <img src="{!URLFOR($Resource.RM_Resource, '/rm_images/process.gif')}" style="width:30px; height:30px;"/> &nbsp;
                                                   </span>
                                               </apex:facet> 
                                               <apex:facet name="stop"> 
                                                   <apex:commandButton action="{!ViewPipeline}" status="deploy" value="View Deployment History" reRender="deploy, errorPanel, deployPanel, pipelinePanel" styleClass="slds-button slds-button--brand btn" style="top: 15px;" title="{!$Label.Deployment_History_Pipeline}"/>
                                               </apex:facet> 
                                            </apex:actionStatus> &nbsp;&nbsp;
                                        </li> -->
                                        <!-- PAGE HEADER / ROW 2 / COLUMN 4 -->
                                        <li class="slds-page-header__detail-block">
                                            <p class="slds-text-heading--label-normal slds-truncate slds-m-bottom--xx-small" title="Field 4"></p>
                                            <apex:actionStatus startText="" stopText="" id="Delete" > 
                                               <apex:facet name="start" > 
                                                   <span style="padding-left:20%;">
                                                       <img src="{!URLFOR($Resource.RM_Resource, '/rm_images/process.gif')}" style="width:30px; height:30px;"/> &nbsp;
                                                   </span>                                  
                                               </apex:facet> 
                                               <apex:facet name="stop">
                                                  
                                               </apex:facet> 
                                            </apex:actionStatus> &nbsp;
                                           <!-- <apex:commandButton action="{!deletebuilds}" action="{!deleteOldBuilds}" value="Archive" status="Delete" reRender="deploy, errorPanel, deployPanel, pipelinePanel" styleClass="slds-button slds-button--brand btn" style="top: 15px;{!IF(manualStepsCompleted == true, '', 'display:none')}" />-->
                                           <!-- <apex:commandButton value="Archive" onclick="myFunction();"  title="Deleting Old Builds" disabled="{!If((selectedRelease != null && selectedOrg != null && (selectedOrg != '-NONE-')),false, true)}" styleClass="slds-button slds-button--brand btn" style="top: 15px;{!IF(manualStepsCompleted == true, 'display:none', '')}"  />-->
                                           <!-- <button onclick="myFunction(); return false;"  title="{!$Label.Delete_Old_Builds}" class="slds-button slds-button--brand btn" style="top: 15px;{!If((selectedRelease != null && selectedOrg != null && (selectedOrg != '-NONE-')),'', 'display:none;')}">Purge History</button> -->
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </apex:outputPanel>
            <!-- /Panel -->
            
           
            
            <!-- Pipeline Panel -->
            <apex:outputPanel id="pipelinePanel" style="{!IF(config.CommandCenter__View_Pipeline__c == false, 'display:none;', '')}" styleClass="cards">
            
                <c:InfoToolTipComponent toolTipText="{!$Label.commandcenter__deployment_history_section}" toolTipTextClassName="jenkin_Config" icon_Margin_Top="38" icon_Margin_Left="8"
                                        toolTipWidth="120" position_Left="-1" position_Bottom="-40"/>
                
                <div class="slds-page-header bgcolor" role="banner">
                    <div class="slds-grid">
                        <div class="slds-col slds-has-flexi-truncate">
                            <div class="slds-media slds-no-space slds-grow">
                                <div class="slds-media__figure">
                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/process_60.png')}" class="sectionHeaderIcon"/>
                                </div>
                                <div class="slds-media__body" >                               
                                    <h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate"> <!--  slds-truncate -->
                                        Build 
                                        <!--<apex:commandButton value="Purge History" onclick="myFunction(); return false;"  title="{!$Label.Delete_Old_Builds}" styleClass="slds-button slds-button--brand btn" style="float:right;{!If((selectedRelease != null && selectedOrg != null && (selectedOrg != '-NONE-')),'', 'display:none;')}"/>  -->
                                    </h1>
                                    <apex:actionStatus startText="" stopText="" id="Delete1" > 
                                        <apex:facet name="start" > 
                                            <span style="padding-left:20%;">
                                                <img src="{!URLFOR($Resource.CommandCenter__RM_Resource, '/rm_images/process.gif')}" style="width:30px; height:30px;"/> 
                                            </span>                                  
                                        </apex:facet> 
                                        <apex:facet name="stop">
                                            
                                        </apex:facet> 
                                    </apex:actionStatus>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Add content Here -->
                    <ul class="slds-grid slds-page-header__detail-row">
                        <li class="slds-page-header__detail-block releaseSection" style="max-width: 100% !important;width: 100%;">
                            <div class="slds-form-element slds-hint-parent slds-has-divider--bottom" style="border-bottom: 0px;margin-bottom: 1%;">
                                <apex:Messages id="showmsg" styleClass="exceptionTxt"><br/></apex:Messages>
                                <div class="slds-form-element__control" style="{!IF(pipelineList.size > 0, 'display:none;', '')}">
                                    <div class="slds-grid"> 
                                        <span style="padding-top: 5px;font-size: 13px;"> No pipeline to display  </span>
                                    </div>
                                </div>
                                <div class="slds-form-element__control" style="{!IF(pipelineList.size > 0, '', 'display:none;')}">
                                    <apex:repeat value="{!pipelineList}" var="v">
                                        <div class="slds-grid" style="border-bottom: 2px solid #a8b7c7;"> 
                                           <span class="buildInfo">
                                                <span>
                                                    <div style="margin-left:10px;">
                                                    {!v.deployment.Name}  <br/>
                                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/user_60.png')}" class="buildInfoIcons"/>
                                                    <apex:outputText value="{!v.deployment.CommandCenter__Pipeline_Owner__c}" title="Owner" style="font-size:10px;"></apex:outputText>   <br/>
                                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/clock_60.png')}" class="buildInfoIcons"/>
                                                    <apex:outputText value="{0, date, MM/dd/yyyy}" title="Created Date" style="font-size:10px;">
                                                        <apex:param value="{!v.deployment.CreatedDate}"/>
                                                    </apex:outputText> <br/>
                                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/clock_60.png')}" class="buildInfoIcons"/>
                                                    <apex:outputText value="{0, time, hh:mm:ss a}" title="Created Time" style="font-size:10px;">
                                                        <apex:param value="{!v.deployment.CreatedDate}"/>
                                                    </apex:outputText> <br/>
                                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/clock_60.png')}" class="buildInfoIcons"/>
                                                    <apex:outputText value="{!v.deployment.CommandCenter__Total_Time__c}" title="Completition Time" style="font-size:10px;">
                                                        
                                                    </apex:outputText>
                                                    
                                                    </div>
                                                </span>
                                            </span>                                           
                                            <div class="slds-tabs--path" style="padding-left:10px;width: 90%" role="application">
                                                <apex:actionStatus startText="" stopText="" id="viewJobStatus" > 
                                                     <apex:facet name="start" > 
                                                         <span style="padding-left:0%;">
                                                             <img src="{!URLFOR($Resource.RM_Resource, '/rm_images/process.gif')}" style="width:30px; height:30px;"/> &nbsp;
                                                         </span>
                                                     </apex:facet> 
                                                     <apex:facet name="stop"> 
                                                     </apex:facet> 
                                                  </apex:actionStatus>
                                                <apex:repeat value="{!v.orderList}" var="order">
                                                <ul class="slds-tabs--path__nav" role="tablist" id="list">
                                                    <apex:repeat value="{!order.stageList}" var="s">
                                                      <li class="slds-tabs--path__item {!s.stageClass}" role="presentation" title="{!IF(s.displayName == true, s.Stage.CommandCenter__Stage_Label__c, '')}">
                                                        <!-- <a class="slds-tabs--path__link" aria-controls="content-path-1" aria-selected="false" tabindex="-1" role="tab" href="javascript:void(0);" aria-live="assertive" onclick="readLogs('{!s.Stage.Id}');">
                                                          <span class="slds-tabs--path__stage">
                                                             <span style="{!IF(s.displayName == true, '', 'display:none')}">{!s.Stage.Stage_Label__c} </span> 
                                                          </span>
                                                          <span class="slds-ta bs--path__title textTruncate"  style="{!IF(s.displayName == true, 'white-space: nowrap;', 'display:none')}">{!s.Stage.Stage_Label__c}</span>
                                                        </a> -->
                                                        <apex:commandLink styleClass="slds-tabs--path__link" action="{!readStageLog}" status="viewJobStatus" reRender="viewJobStatus, logPanel, stepLogPanel, pipelinePanel, errorPanel" title="{!IF(s.displayName == true, s.Stage.CommandCenter__Stage_Label__c, '')}">
                                                            <apex:param name="jobName" value="{!s.Stage.Id}"/>
                                                            <span class="slds-tabs--path__stage">
                                                                <span style="{!IF(s.displayName == true, '', 'display:none')}">{!s.Stage.CommandCenter__Stage_Label__c} </span>
                                                            </span>
                                                            <span class="slds-tabs--path__title textTruncate" style="{!IF(s.displayName == true, '', 'display:none')}">
                                                                {!s.Stage.CommandCenter__Stage_Label__c}
                                                            </span>
                                                        </apex:commandLink>
                                                      </li>
                                                      
                                                    </apex:repeat>
                                                </ul>
                                                <div style="height:10px;">
                                                </div>
                                                </apex:repeat>
                                            </div>
                                        </div>
                                        <br/>
                                    </apex:repeat>
                                    <div class="slds-align--absolute-center">
                                      <apex:commandButton action="{!ShowMore}" status="Show more" value="Show More" reRender="deploy, errorPanel, deployPanel, pipelinePanel" styleClass="slds-button slds-button--brand btn" style="top: 15px; text-align: center;" rendered="{!showMoreVarButtonEnable}" title="{!$Label.commandcenter__show_old_builds}"/>
                                      <apex:commandButton action="{!ShowLess}" rendered="{!IF(pipelineList.size > 5, true, false)}" status="Show less" value="Show Less" reRender="deploy, errorPanel, deployPanel, pipelinePanel" styleClass="slds-button slds-button--brand btn" style="top: 15px; text-align: center;" title = "{!$Label.commandcenter__hide_old_builds}"/>
                                    </div> 
                                </div>
                            </div>
                        </li>
                    </ul>
                    <!-- /Add content Here -->
                </div>
            </apex:outputPanel>
            <!-- /Panel -->
            
            <!-- Log Popup -->
            <apex:outputPanel id="stepLogPanel"  style="{!IF(showLog == true, '', 'display:none')}" >
                <script type="text/javascript">
                    $(document).ready(function() 
                    {
                        $(".Downloadscontainer ul li ul").css("display", "none");
                        $(".Downloadscontainer a").click(function (e) {
                            e.preventDefault();
                            $(this).closest('li').children('ul').toggle();
                        });
                    });
                </script>    
                <div id="stepLogModal" role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open slds-modal--large">
                    <div class="slds-modal__container" style="width: 96% !important;">
                        <div class="slds-modal__header">
                            <h4 id="header43" class="slds-text-heading--medium" style="font-weight:bold;">
                                <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/knowledge_base_60.png')}" class="sectionHeaderIcon"/>
                                {!logStageName} - Log
                            </h4>
                        </div>
                        <div class="slds-modal__content slds-p-around--medium" style="height: 65%;">
                            <!-- Show Log -->
                            <div style="{!IF((contains(LOWER(logStageName), 'validation') && deploymentId != null) 
                                          || contains(LOWER(logStageName), 'release') 
                                          || contains(LOWER(logStageName), 'diff') 
                                          || contains(LOWER(logStageName), 'tas') 
                                          || (contains(LOWER(logStageName), LOWER('deploy_CI'))  && deploymentId != null), 
                                          'display:none;', '')}">
                                <apex:outputText id="logResult" style="width:100%;"> 
                                    <pre> {!logString}</pre>
                                </apex:outputText>
                            </div>
                            <!-- Show Log -->
                            <!-- Show TAS Summary -->
                            <div style="{!IF(contains(LOWER(logStageName), 'tas'), '', 'display:none;')}">
                                <h2 class="slds-text-title--caps" style="font-size: 1rem;margin-left: 30%;" id="treeheading">
                                    TAS Test Cases:
                                </h2>
                                <br/>
                                <div style="margin-left: 5%;">
                                     <apex:outputText value="{!summary}" escape="false"></apex:outputText>
                                </div>
                            </div>
                            
                            <!-- Show Summary -->
                            <!-- Show validation/Deploy CI Summary -->
                            <div style="{!IF(((contains(LOWER(logStageName), 'validation')  || contains(LOWER(logStageName), LOWER('deploy_CI'))) && deploymentId != null), '', 'display:none;')}">
                                <h2 class="slds-text-title--caps" style="font-size: 1rem;margin-left: 30%;" id="treeheading">
                                        Deployment Status:
                                </h2>
                                <br/>
                                <div style="margin-left: 5%;">
                                    <apex:outputPanel rendered="{!IF((contains(LOWER(logStageName), 'validation')  || contains(LOWER(logStageName), LOWER('deploy_CI'))) && (failureList.size == 0),true, false)}">
                                        <script>
                                            FusionCharts.ready(function () {
                                                var revenueChart = new FusionCharts({
                                                    type: 'doughnut3d',
                                                    renderAt: 'chart-container',
                                                    width: '500',
                                                    height: '450',
                                                    dataFormat: 'json',
                                                    dataSource: {
                                                        "chart": {
                                                            "caption": "Deployment Details",
                                                            "subCaption": "",
                                                            "paletteColors": "#0075c2,#1aaf5d,#f2c500,#f45b00,#8e0000,#36486b,#77a8a8,#96897f,#5b9aa0,#622569,#c83349,#588c7e",
                                                            "bgColor": "#ffffff",
                                                            "showBorder": "0",
                                                            "use3DLighting": "0",
                                                            "showShadow": "0",
                                                            "enableSmartLabels": "0",
                                                            "startingAngle": "310",
                                                            "showLabels": "0",
                                                            "showPercentValues": "0",
                                                            "showLegend": "1",
                                                            "legendShadow": "0",
                                                            "legendBorderAlpha": "0",                                
                                                            "decimals": "0",
                                                            "captionFontSize": "14",
                                                            "subcaptionFontSize": "14",
                                                            "subcaptionFontBold": "0",
                                                            "toolTipColor": "#ffffff",
                                                            "toolTipBorderThickness": "0",
                                                            "toolTipBgColor": "#000000",
                                                            "toolTipBgAlpha": "80",
                                                            "toolTipBorderRadius": "2",
                                                            "enableMultiSlicing": "0",
                                                            "toolTipPadding": "5",
                                                            "showPercentInToolTip":"0",
                                                            "showValues":"0",
                                                            "pieRadius": "160",
                                                            "defaultCenterLabel": "Total Components: {!totalComp}",
                                                        },
                                                        "data":{!chartDataString}
                                                    }
                                                }).render();
                                                
                                                if('{!chartTestData}' != '[]'){
                                                    generateTestResultChart();
                                                }
                                            });
                                            
                                            function generateTestResultChart(){
                                                var revenueChart = new FusionCharts({
                                                    type: 'doughnut3d',
                                                    renderAt: 'chart-container-test',
                                                    width: '500',
                                                    height: '450',
                                                    dataFormat: 'json',
                                                    dataSource: {
                                                        "chart": {
                                                            "caption": "Deployment Details",
                                                            "subCaption": "",
                                                            "numberPrefix": "",
                                                            "paletteColors": "#0075c2,#1aaf5d,#f2c500,#f45b00,#8e0000",
                                                            "bgColor": "#ffffff",
                                                            "showBorder": "0",
                                                            "use3DLighting": "0",
                                                            "showShadow": "0",
                                                            "enableSmartLabels": "0",
                                                            "startingAngle": "310",
                                                            "showLabels": "0",
                                                            "showPercentValues": "0",
                                                            "showLegend": "1",
                                                            "legendShadow": "0",
                                                            "legendBorderAlpha": "0",                                
                                                            "decimals": "0",
                                                            "captionFontSize": "14",
                                                            "subcaptionFontSize": "14",
                                                            "subcaptionFontBold": "0",
                                                            "toolTipColor": "#ffffff",
                                                            "toolTipBorderThickness": "0",
                                                            "toolTipBgColor": "#000000",
                                                            "toolTipBgAlpha": "80",
                                                            "toolTipBorderRadius": "2",
                                                            "toolTipPadding": "5",
                                                        },
                                                        "data": [
                                                            {
                                                                "label": "Food",
                                                                "value": "1"
                                                            }
                                                        ] 
                                                    }
                                                }).render();
                                            }
                                        </script>
                                        <div id="chart-container" style="float:left;"></div>
                                        <!-- <div id="chart-container-test" style="float:right;"></div> -->
                                    </apex:outputPanel>
                                     
                                </div>
                            </div>
                            <!-- Show Summary -->
                          
                            <!-- Show Summary -->
                            <div style="{!IF(contains(LOWER(logStageName), 'release'), '', 'display:none;')}">
                                <h2 class="slds-text-title--caps" style="font-size: 1rem;margin-left: 30%;" id="treeheading">
                                    Deployed Components in Target Environment:
                                </h2>
                                <br/>
                                <div style="margin-left: 25%;">
                                    <apex:outputText value="{!summary}" escape="false"></apex:outputText>
                                </div>
                            </div>
                            <!-- Show Summary -->
                            <!-- Show Env Diff Summary -->
                            <div style="{!IF(contains(LOWER(logStageName), 'diff'), '', 'display:none;')}">
                                <h2 class="slds-text-title--caps" style="font-size: 1rem;margin-left: 30%;" id="treeheading">Environment Difference Output:</h2>
                                <br/>
                                <div style="margin-left: 20%;width: 50%;">
                                    <apex:outputText value="{!summary}" escape="false"></apex:outputText>
                                </div>
                            </div>
                            <!-- Show Summary -->
                             <div style="{!IF((contains(LOWER(logStageName), 'validation')  || contains(LOWER(logStageName), LOWER('deploy_CI'))) && (NOT(ISNULL(failureList)) && failureList.size != 0) , '', 'display:none;')}">
                                
                                <a href="/apex/ExportErrors?d={!deploymentId}&a={!authId}&i={!instanceURL}" target="_blank">
                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/doctype/excel_60.png')}" class="sectionHeaderIcon" title="Export to Excel" align="right"/>
                                </a>
                                
                                <apex:pageBlock title="Component Failures:" rendered="{!NOT(ISNULL(failureList)) && failureList.size != 0}">
                                <apex:pageBlockTable value="{!failureList}" var="obj" title="Failures:" border="1" columns="5" rendered="{!NOT(ISNULL(failureList))}" >
                                    <apex:column >
                                        <apex:facet name="header">Line#</apex:facet>
                                            {!obj.lineNumber}
                                    </apex:column>
                                    <apex:column >
                                        <apex:facet name="header">Problem</apex:facet> 
                                            {!obj.problem} 
                                    </apex:column>
                                  <apex:column >
                                  <apex:facet name="header">Problem Type</apex:facet>
                                       {!obj.problemType} 
                                  </apex:column>
                                  <apex:column >
                                  <apex:facet name="header">Component Type</apex:facet>
                                      {!obj.componentType}
                                  </apex:column>
                                  <apex:column >
                                  <apex:facet name="header">File Name</apex:facet>
                                      {!obj.fileName}
                                   </apex:column>
                                
                                </apex:pageBlockTable>
                                </apex:pageBlock>
                                
                                
                             </div>
                            
                            <!-- Show Workspace -->
                          <!--  <div style="{!IF(contains(logStageName, 'validation'), '', 'display:none;')}">
                                <h4 class="slds-text-title--caps" id="treeheading">Workspace</h4>
                                <div class="Downloadscontainer" style="float:left;width:50%;border-right: 1px solid #8199af;min-height: 550px;">
                                    <apex:repeat value="{!artifactMap}" var="root">
                                        <ul class="slds-tree" role="tree">
                                            <li role="treeitem" aria-level="1">
                                                <div>
                                                    <a href="#" style="text-decoration:none;">
                                                        <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/open_folder_60.png')}" class="sectionHeaderIcon"/>
                                                        {!root}
                                                    </a>&nbsp;&nbsp;
                                                    <a href="#" onclick="window.open('{!jenkinsJob.Pipeline_URL__c}job/{!jenkinsJob.Jenkins_Job_Name__c}/ws/Deploy/dist/*zip*/dist.zip')" target="_blank" style="text-decoration:none;">
                                                        Download &nbsp;
                                                        <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/download_60.png')}" class="sectionHeaderIcon"/>
                                                    </a>
                                                </div>
                                                <apex:repeat value="{!artifactMap[root]}" var="folder">
                                                    <ul>
                                                        <li role="treeitem" aria-level="2">
                                                            <div class="slds-tree__item" style="padding-left: 2rem;">
                                                                <a href="#" style="{!IF(contains(folder, 'z_'), 'display:none;', '')}">
                                                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/open_folder_60.png')}" class="treeIcon" style="{!IF(contains(folder, 'z_'), 'display:none;', '')}"/>
                                                                    <!-*- <apex:outputText value="{!IF(contains(folder, 'z_'), SUBSTITUTE(folder, 'z_', ''), folder)}"></apex:outputText> -*->
                                                                    {!folder}
                                                                  </a>
                                                                <a href="#" style="{!IF(contains(folder, 'z_'), '', 'display:none;')}" onclick="window.open('{!jenkinsJob.Pipeline_URL__c}job/{!jenkinsJob.Jenkins_Job_Name__c}/ws/Deploy/dist/{!IF(contains(folder, 'z_'), SUBSTITUTE(folder, 'z_', ''), folder)}')" target="_blank">
                                                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/doctype/txt_60.png')}" class="treeIcon" style="{!IF(contains(folder, 'z_'), '', 'display:none;')}"/>
                                                                    <apex:outputText value="{!IF(contains(folder, 'z_'), SUBSTITUTE(folder, 'z_', ''), folder)}"></apex:outputText>
                                                                </a>
                                                              </div>
                                                            <apex:repeat value="{!artifactMap[root][folder]}" var="file">
                                                                <ul>
                                                                    <li role="treeitem" aria-level="3">
                                                                        <div class="slds-tree__item" style="padding-left: 3.5rem;">
                                                                            <a href="#" onclick="window.open('{!jenkinsJob.Pipeline_URL__c}job/{!jenkinsJob.Jenkins_Job_Name__c}/ws/Deploy/dist/{!folder}/{!file}')" target="_blank" style="text-decoration:none;">
                                                                                <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/doctype/txt_60.png')}" class="treeIcon"/>
                                                                                {!file}
                                                                            </a>
                                                                          </div>
                                                                    </li>
                                                                </ul>
                                                            </apex:repeat>
                                                        </li>
                                                    </ul>
                                                </apex:repeat>
                                            </li>
                                        </ul>
                                    </apex:repeat>
                                </div>
                                <div style="float:right;margin-right: 15%;"> -->
                                    <!-- Add content Here -->
                                  <!--  <ul class="slds-grid slds-page-header__detail-row" style="margin-top: 0px;padding-top: 0px;">
                                        <li class="slds-page-header__detail-block releaseSection" style="max-width: 100% !important;width: 100%;">
                                            <div class="slds-form-element slds-hint-parent">
                                                <div class="slds-form-element__control">
                                                    <div style="width: 100%;float: left;">
                                                        <h4 class="slds-text-title--caps" id="treeheading">
                                                            <b style="margin-left: 25%;">Component Summary</b>
                                                        </h4>
                                                        <div style="width: 25%;float: left;">
                                                            <table class="slds-table slds-table--bordered slds-table--cell-buffer slds-table--striped" style="border-left: 1px solid #d8dde6; border-right: 1px solid #d8dde6;">
                                                                <thead>
                                                                    <tr class="slds-text-title--caps">
                                                                        <th scope="col">
                                                                            <div class="slds-truncate" title="Component Name"><b>Component</b></div>
                                                                        </th>
                                                                        <th scope="col">
                                                                            <div class="slds-truncate" title="Total number of components"><b>No. Of Components</b></div>
                                                                        </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <apex:repeat value="{!artifactMap}" var="root">
                                                                        <apex:repeat value="{!artifactMap[root]}" var="folder"><!-*-  rendered="{!IF(artifactMap[root].size > 0, true, false)}" -*->
                                                                            <apex:variable value="{!artifactMap[root][folder]}" var="size"/>
                                                                            <tr style="{!IF(contains(folder, 'z_'), 'display:none;', '')}">
                                                                                <td data-label="Component">
                                                                                    <div class="slds-truncate" title="Target Org">{!folder}</div>
                                                                                </td>
                                                                                <td data-label="Total">
                                                                                    <div class="slds-truncate" style="text-align: center;">
                                                                                    <apex:outputLabel value="{!size.size}"></apex:outputLabel> 
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                            
                                                                        </apex:repeat>
                                                                    </apex:repeat>
                                                                    <tr style="{!IF(artifactSize > 0, 'display:none;', '')}">
                                                                        <td scope="row" data-label="Pipeline Numner" colspan="2">
                                                                            <div class="slds-truncate" title="no data to display">No data to display</div>
                                                                        </td>    
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                   </div>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                    <!-*- /Add content Here -*->
                                </div>
                            </div>-->
                            <!-- /Show Workspace -->
                        </div> 
                        <div class="slds-modal__footer">
                            <apex:actionStatus startText="" stopText="" id="cancelLog" > 
                               <apex:facet name="start" > 
                                   <span style="padding-left:30%;">
                                       <img src="{!URLFOR($Resource.RM_Resource, '/rm_images/process.gif')}" style="width:30px; height:30px;"/> &nbsp;
                                   </span>
                               </apex:facet> 
                               <apex:facet name="stop"> 
                               </apex:facet> 
                            </apex:actionStatus>
                            <apex:repeat value="{!newdocList}" var="d">
                                <span style="{!IF(d.attachmentStoredInFiles == false, '', 'display:none')}">
                                    <a href="/apex/showLog?docId={!d.docId}" target="_blank" title="Open {!d.doc.Name}" style="{!IF(contains(d.doc.Name, '.html'), '', 'display:none')}">
                                        <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/doctype/')}{!fileTypeMap[d.fileType]}" class="sectionHeaderIcon"/>
                                    </a>
                                    
                                    <a href="/servlet/servlet.FileDownload?file={!d.docId}" target="_blank" title="{!IF(contains(d.doc.Name, '.log'), 'Open '+ d.doc.Name,  'Download '+ d.doc.Name)}" style="{!IF(contains(d.doc.Name, '.html'), 'display:none', '')}">
                                        <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/doctype/')}{!fileTypeMap[d.fileType]}" class="sectionHeaderIcon"/>
                                    </a>
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                </span>
                                <span style="{!IF(d.attachmentStoredInFiles == true, '', 'display:none')}">
                                    <a href="https://cc--ccltngdev.cs70.my.salesforce.com/sfc/servlet.shepherd/version/download/{!d.docId}" target="_blank" title="Download {!d.doc.Name}">
                                        <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/doctype/')}{!fileTypeMap[d.fileType]}" class="sectionHeaderIcon"/>
                                    </a>
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                </span>
                            </apex:repeat>
                            <apex:commandButton action="{!exitLog}" value="Close" status="cancelLog" reRender="cancelLog, stepLogPanel" styleClass="slds-button slds-button--brand btn"/>
                        </div>
                    </div>
                </div>
                <div class="slds-backdrop slds-backdrop--open"></div>
            </apex:outputPanel>
            <!-- /Popup -->
            
            <!-- Manual Step Tracker Popup 
            <apex:outputPanel id="stepLogPanel"  style="{!IF(showLog == true, '', 'display:none')}" >
                <script type="text/javascript">
                    $(document).ready(function() 
                    {
                        $(".Downloadscontainer ul li ul").css("display", "none");
                        $(".Downloadscontainer a").click(function (e) {
                            e.preventDefault();
                            $(this).closest('li').children('ul').toggle();
                        });
                    });
                </script> 
            <div id="stepLogModal" role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open slds-modal--large">
                <div class="slds-modal__container" style="width: 96% !important;">
                    <div class="slds-modal__header">
                        <h4 id="header43" class="slds-text-heading--medium" style="font-weight:bold;">
                            <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/knowledge_base_60.png')}" class="sectionHeaderIcon"/>
                            {!logStageName} - {!selectedDeployment}
                        </h4>
                    </div>
                    <div class="slds-modal__content slds-p-around--medium">
                        <!-- Show Log
                        <div style="{!IF(contains(logStageName, 'validation') || contains(logStageName, 'Release'), 'display:none;', '')}">
                            <apex:iframe src="/servlet/servlet.FileDownload?file={!currentLog.Id}" scrolling="true"/>
                        </div>
                        <!-- Show Log 
                        <!-- Show Summary 
                        <div id="showsummary" style="{!IF(contains(logStageName, 'Release'), '', 'display:none;')};">
                            <h2 class="slds-text-title--caps" style="font-size: 1rem;margin-left: 30%;" id="treeheading">Deployed Components in Target Environment:</h2>
                            <br/>
                            <div style="margin-left: 35%;">
                               <apex:outputText value="{!summary}" escape="false"></apex:outputText>
                            </div>
                        </div>
                        <!-- Show Summary 
                        <!-- Show Workspace 
                        <div id="showworkspace" style="{!IF(contains(logStageName, 'validation'), '', 'display:none;')}">
                            <h4 class="slds-text-title--caps" id="treeheading">Workspace</h4>
                            <div class="Downloadscontainer">
                                <apex:repeat value="{!artifactMap}" var="root">
                                    <ul class="slds-tree" role="tree">
                                        <li role="treeitem" aria-level="1">
                                            <div>
                                                <a href="#" style="text-decoration:none;">
                                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/open_folder_60.png')}" class="sectionHeaderIcon"/>
                                                    {!root}
                                                </a>&nbsp;&nbsp;
                                                <a href="#" onclick="window.open('{!jenkinsJob.Pipeline_URL__c}job/{!jenkinsJob.Jenkins_Job_Name__c}/ws/Deploy/dist/*zip*/dist.zip')" target="_blank" style="text-decoration:none;">
                                                    Download &nbsp;
                                                    <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/download_60.png')}" class="sectionHeaderIcon"/>
                                                </a>
                                            </div>
                                            <apex:repeat value="{!artifactMap[root]}" var="folder">
                                                <ul>
                                                    <li role="treeitem" aria-level="2">
                                                        <div class="slds-tree__item" style="padding-left: 2rem;">
                                                            <a href="#" style="{!IF(contains(folder, 'z_'), 'display:none;', '')}">
                                                                <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/open_folder_60.png')}" class="treeIcon" style="{!IF(contains(folder, 'z_'), 'display:none;', '')}"/>
                                                                <!-- <apex:outputText value="{!IF(contains(folder, 'z_'), SUBSTITUTE(folder, 'z_', ''), folder)}"></apex:outputText> 
                                                                {!folder}
                                                              </a>
                                                            <a href="#" style="{!IF(contains(folder, 'z_'), '', 'display:none;')}" onclick="window.open('{!jenkinsJob.Pipeline_URL__c}job/{!jenkinsJob.Jenkins_Job_Name__c}/ws/Deploy/dist/{!IF(contains(folder, 'z_'), SUBSTITUTE(folder, 'z_', ''), folder)}')" target="_blank">
                                                                <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/doctype/txt_60.png')}" class="treeIcon" style="{!IF(contains(folder, 'z_'), '', 'display:none;')}"/>
                                                                <apex:outputText value="{!IF(contains(folder, 'z_'), SUBSTITUTE(folder, 'z_', ''), folder)}"></apex:outputText>
                                                            </a>
                                                          </div>
                                                        <apex:repeat value="{!artifactMap[root][folder]}" var="file">
                                                            <ul>
                                                                <li role="treeitem" aria-level="3">
                                                                    <div class="slds-tree__item" style="padding-left: 3.5rem;">
                                                                        <a href="#" onclick="window.open('{!jenkinsJob.Pipeline_URL__c}job/{!jenkinsJob.Jenkins_Job_Name__c}/ws/Deploy/dist/{!folder}/{!file}')" target="_blank" style="text-decoration:none;">
                                                                            <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/doctype/txt_60.png')}" class="treeIcon"/>
                                                                            {!file}
                                                                        </a>
                                                                      </div>
                                                                </li>
                                                            </ul>
                                                        </apex:repeat>
                                                    </li>
                                                </ul>
                                            </apex:repeat>
                                        </li>
                                    </ul>
                                </apex:repeat>
                            </div>
                        </div>
                        <!-- /Show Workspace 
                    </div>
                    <div class="slds-modal__footer">
                        <apex:actionStatus startText="" stopText="" id="cancelLog" > 
                           <apex:facet name="start" > 
                               <span style="padding-left:30%;">
                                   <img src="{!$Resource.ProcessingIcon}" style="width:30px; height:30px;"/> &nbsp;
                               </span>
                           </apex:facet> 
                           <apex:facet name="stop"> 
                           </apex:facet> 
                        </apex:actionStatus>
                        <apex:repeat value="{!docList}" var="d">
                            <a href="/servlet/servlet.FileDownload?file={!d.Id}" target="_blank" title="Download {!d.Name}">
                                <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/download_60.png')}" class="sectionHeaderIcon"/>
                            </a>&nbsp;&nbsp;&nbsp;&nbsp;
                        </apex:repeat>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <apex:commandButton action="{!exitLog}" value="Exit" status="cancelLog" reRender="cancelLog, stepLogPanel" styleClass="slds-button slds-button--brand btn"/>
                    </div>
                </div>
            </div>
            <div class="slds-backdrop slds-backdrop--open"></div>
            </apex:outputPanel>
            
            <!-- /Popup -->  
            <!-- ERROR Popup -->
            <apex:outputPanel id="errorPanel"  style="{!IF(isError == true, '', 'display:none')}" >
                <div role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container" style="width: 30% !important;">
                        <div class="slds-modal__header slds-modal__header slds-modal__header--empty">
                        </div>
                        <div class="slds-modal__content slds-p-around--medium">
                            <div>
                                <img src="{!URLFOR($Resource.SDLCV_2_1_3, '/assets/icons/utility/error_60.png')}" style="width:30px; height:30px;"/>
                                Error: {!errorMessage}
                            </div>
                        </div>
                        <div class="slds-modal__footer">
                            <apex:actionStatus startText="" stopText="" id="okStatus" > 
                               <apex:facet name="start" > 
                                   <span style="padding-left:30%;">
                                       <img src="{!URLFOR($Resource.RM_Resource, '/rm_images/process.gif')}" style="width:30px; height:30px;"/> &nbsp;
                                   </span>
                               </apex:facet> 
                               <apex:facet name="stop"> 
                               </apex:facet> 
                            </apex:actionStatus>
                            <apex:commandButton action="{!hideErrorPopup}" value="Ok" status="okStatus" reRender="okStatus, errorPanel" styleClass="slds-button slds-button--brand btn"/>
                        </div>
                    </div>
                </div>
                <div class="slds-backdrop slds-backdrop--open"></div>
            </apex:outputPanel>
            <!-- /ERROR Popup -->
      </div>
  </apex:form>
  </body>
  </html>
</apex:page>